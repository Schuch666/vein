p1 <- pc_profile[, 1]
adt1 <- adt(pc = net$ldv*0.75,
lcv = net$ldv*0.1,
hgv = net$hdv,
bus = 0,
mc = net$ldv*0.15,
p_pc = p1,
p_lcv = p1,
p_hgv = p1,
p_bus = p1,
p_mc = p1)
adt1
net@data <- head(net@data)
data(pc_profile)
p1 <- pc_profile[, 1]
adt1 <- adt(pc = net$ldv*0.75,
lcv = net$ldv*0.1,
hgv = net$hdv,
bus = 0,
mc = net$ldv*0.15,
p_pc = p1,
p_lcv = p1,
p_hgv = p1,
p_bus = p1,
p_mc = p1)
adt1
adt
devtools::load_all(".")
library(vein)
use_coverage(pkg = ".", type = c("codecov"))
file.choose()
devtools::load_all(".")
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
devtools::load_all(".")
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
devtools::load_all(".")
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
devtools::load_all(".")
devtools::load_all(".")
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
install.packages("covr")
devtools::load_all(".")
devtools::load_all(".")
data(pc_profile)
data(profiles)
profiles$PC_JUNE_2014
devtools::load_all(".")
profiles$PC_JUNE_2014
devtools::load_all(".")
devtools::load_all(".")
args(emis_merge)
data(net)
data(pc_profile)
data(fe2015)
data(fkm)
PC_G <- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
133833,138441,142682,171029,151048,115228,98664,126444,101027,
84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
veh <- data.frame(PC_G = PC_G)
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
pcw <- temp_fact(net$ldv+net$hdv, pc_profile)
speed <- netspeed(pcw, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
pckm <- fkm[[1]](1:24); pckma <- cumsum(pckm)
cod1 <- emis_det(po = "CO", cc = 1000, eu = "III", km = pckma[1:11])
cod2 <- emis_det(po = "CO", cc = 1000, eu = "I", km = pckma[12:24])
#vehicles newer than pre-euro
co1 <- fe2015[fe2015$Pollutant=="CO", ] #24 obs!!!
cod <- c(co1$PC_G[1:24]*c(cod1,cod2),co1$PC_G[25:nrow(co1)])
lef <- ef_ldv_scaled(co1, cod, v = "PC", t = "4S", cc = "<=1400",
f = "G",p = "CO", eu=co1$Euro_LDV)
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed, agemax = 41,
profile = pc_profile, hour = 24, day = 7, array = T)
class(E_CO)
E_CO_STREETS <- emis_post(arra = E_CO, pollutant = "CO", by = "streets_wide")
net@data <- cbind(net@data, E_CO_STREETS)
head(net@data)
g <- make_grid(net, 1/102.47/2, 1/102.47/2) #500m in degrees
net@data <- net@data[,- c(1:9)]
names(net)
E_CO_g <- emis_grid(spobj = net, g = g, sr= 31983)
head(E_CO_g) #class sf
library(mapview)
mapview(E_CO_g, zcol= "V1", legend = T, col.regions = cptcity::cptcity(1))
gr <- GriddedEmissionsArray(E_CO_g, rows = 19, cols = 23, times = 168, T)
plot(gr)
devtools::load_all(".")
ef1 <- ef_evap(ef = "erhotc",v = "PC", cc = "<=1400", dt = "0_15", ca = "no")
class(ef1)
dfe <- emis_evap(rep(50,3),"PC","<=1400","G", 1:3,
10,4,2,1,
ef1*1:3, ef1*1:3, ef1*1:3, ef1*1:3,
ef1*1:3, ef1*1:3, ef1*1:3, ef1*1:3,
ef1*1:3, ef1*1:3, ef1*1:3, ef1*1:3)
ef1
data(net)
PC_G <- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
133833,138441,142682,171029,151048,115228,98664,126444,101027,
84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
veh <- data.frame(PC_G = PC_G)
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
ef1 <- ef_evap(ef = "erhotc",v = "PC", cc = "<=1400", dt = "0_15", ca = "no")
dfe <- emis_evap(veh = pc1,
name = "PC",
size = "<=1400",
fuel = "G",
aged = 1:ncol(pc1),
nd4 = 10,
nd3 = 4,
nd2 = 2,
nd1 = 1,
hs_nd4 = ef1*1:ncol(pc1),
hs_nd3 = ef1*1:ncol(pc1),
hs_nd2 = ef1*1:ncol(pc1),
hs_nd1 = ef1*1:ncol(pc1),
d_nd4 = ef1*1:ncol(pc1),
d_nd3 = ef1*1:ncol(pc1),
d_nd2 = ef1*1:ncol(pc1),
d_nd1 = ef1*1:ncol(pc1),
rl_nd4 = ef1*1:ncol(pc1),
rl_nd3 = ef1*1:ncol(pc1),
rl_nd2 = ef1*1:ncol(pc1),
rl_nd1 = ef1*1:ncol(pc1))
ef1
ef1 <- unclass(Ef1)
ef1 <- unclass(ef1)
ef1
ef1 <- as.numeric(ef1)
ef1
dfe <- emis_evap(rep(50,3),"PC","<=1400","G", 1:3,
10, 4, 2, 1,
ef1*1:3, ef1*1:3, ef1*1:3, ef1*1:3,
ef1*1:3, ef1*1:3, ef1*1:3, ef1*1:3,
ef1*1:3, ef1*1:3, ef1*1:3, ef1*1:3)
ef1 <- ef_evap(ef = "erhotc",v = "PC", cc = "<=1400", dt = "0_15", ca = "no")
class(ef1)
devtools::load_all(".")
devtools::load_all(".")
ev <- running_losses(x = 1:10, carb = 0, p = 1, erhot = 1, erwarmc =1,
erhotfi = 1)
plot(ev)
ev
ev <- running_losses(x = 1:10, carb = 0, p = 1, erhot = 1, erwarmc =1,
erhotfi = 1)
ev
summary(ev)
ev
devtools::load_all(".")
library(vein)
inventory(name = file.path(tempdir(), "YourCity"))
# paste0(file.path(tempdir(), "YourCity"), "/main.R
paste0(file.path(tempdir(), "YourCity"), "/main.R
)
nventory("~/Documentos/teste")
inventory("~/Documentos/teste")
devtools::load_all(".")
inventory("~/Documentos/teste")
library(vein)
library(vein)
inventory("~/Documentos/teste")
devtools::load_all(".")
library(vein)
inventory("~/Documentos/teste")
cat
cat("~/Documentos/teste/main.R")
readLines("~/Documentos/teste/main.R")[1]
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
inventory(name = file.path(tempdir(), "YourCity"))
devtools::load_all(".")
inventory(name = file.path(tempdir(), "YourCity"))
library(vein)
inventory(name = file.path(tempdir(), "YourCity"))
inventory(name = file.path(tempdir(), "YourCity"), show.dir = T,
show.scripts = T)
devtools::load_all(".")
devtools::load_all(".")
devtools::load_all(".")
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
library(vein)
?age_ldv
?temp_fact
knitr::opts_chunk$set(echo = TRUE)
data("profiles")
data("net")
PC_E25_1400 <- age_ldv(x = net$ldv, name = "PC_E25_1400")
plot(PC_E25_1400)
pc_week <- temp_fact(net$ldv+net$hdv, profiles$LCV_JUNE_2012)
?netspeed
data("net")
data("profiles")
pc_week <- temp_fact(net$ldv+net$hdv, profiles$PC_JUNE_2014)
class(df)
plot(df)
class(df)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm)
class(df)
plot(df)
?ef_ldv_speed
?emis
lef <- lapply(1:40, function(i) {
ef_ldv_speed(v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = euro[i], p = "CO", show.equation = FALSE) })
euro <- c(rep("V", 5), rep("IV", 5), rep("III", 5), rep("II", 5),
rep("I", 5), rep("PRE", 15))
lef <- lapply(1:40, function(i) {
ef_ldv_speed(v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = euro[i], p = "CO", show.equation = FALSE) })
lef
pc_week <- temp_fact(net$ldv+net$hdv, profiles$PC_JUNE_2014)
dfspeed <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm)
class(dfspeed)
#emis change length of 'ef' to match ncol of 'veh'
E_CO <- emis(veh = PC_E25_1400, lkm = net$lkm, ef = lef, speed = dfspeed,
profile = profiles$PC_JUNE_2014)
plot(E_CO)
?emis_post
E_CO_STREETS <- emis_post(arra = E_CO, pollutant = "CO", by = "streets_wide")
summary(E_CO_STREETS)
names(E_CO_STREETS)
?emis_merge
emis?grid
emis_grid
?emis_grid
E_CO_g <- emis_grid(spobj = net, g = g, sr= 31983)
g <- make_grid(net, 1/102.47/2, 1/102.47/2) #500m in degrees
E_CO_g <- emis_grid(spobj = net, g = g, sr= 31983)
net@data <- net@data[,- c(1:9)]
g <- make_grid(net, 1/102.47/2, 1/102.47/2) #500m in degrees
E_CO_g <- emis_grid(spobj = net, g = g, sr= 31983)
net
net@data
names(net)
data(net)
net@data <- net@data[,- c(1:9)]
g <- make_grid(net, 1/102.47/2, 1/102.47/2) #500m in degrees
E_CO_g <- emis_grid(spobj = net, g = g, sr= 31983)
head(net)
data(net)
g <- make_grid(net, 1/102.47/2, 1/102.47/2) #500m in degrees
E_CO_g <- emis_grid(spobj = E_CO_STREETS, g = g, sr= 31983)
data(net)
net@data <- cbind(net@data, E_CO_STREETS)
net@data <- net@data[,- c(1:9)]
g <- make_grid(net, 1/102.47/2, 1/102.47/2) #500m in degrees
E_CO_g <- emis_grid(spobj = E_CO_STREETS, g = g, sr= 31983)
names(net)
class(net)
E_CO_g <- emis_grid(spobj = net, g = g, sr= 31983)
plot(E_CO_g)
pkgdown:::build_site_rstudio()
inventory(name = file.path(tempdir(), "YourCity"), show.dir = TRUE,
show.scripts = TRUE)
library(vein)
inventory(name = file.path(tempdir(), "YourCity"), show.dir = TRUE,
show.scripts = TRUE)
lista <- list.dirs(path = paste0(file.path(tempdir(), "YourCity"),"/est"))
lista
lista <- lista[2:length(lista)]
lista
name = file.path(tempdir(), "YourCity")
lista2 <- gsub(pattern = name, x = lista, replacement = "")
lista2
lista3 <- gsub(pattern = "/est/", x = lista2, replacement = "")
lista3
class(lista3)
cat("vname <- ", deparse(lista3, "\n")
)
cat("vname <- ,lista3[1], "\n")
cat("vname <- ",lista3[1], "\n")
cat("vname <- ",lista3[2], "\n")
lista
lista2
name
lista3
paste0(dirs[1], "/est/", lista3[i],"_input.R")
dirs <- list.dirs(path = name, full.names = TRUE, recursive = TRUE)
paste0(dirs[1], "/est/", lista3[i],"_input.R")
paste0(dirs[1], "/est/", lista3[1],"_input.R")
dirs <- list.dirs(path = name, full.names = TRUE)
dirs[1]
paste0(dirs[1], "/est/", lista3[i],"_input.R")
paste0(dirs[1], "/est/", lista3[4],"_input.R")
.Deprecated("df is not used")
?.Deprecated
.Deprecated(msg = "df is not used")
#' a specific type of vehicle
#' @export
#' @examples {
#' # Do not run
#' data(fe2015)
#' co1 <- fe2015[fe2015$Pollutant=="CO",]
#' FE_LT_7_5_D_CO <- ef_hdv_scaled(co1, co1$LT, v = "Trucks", t = "RT",
#' g = "<=7.5", eu = co1$Euro_HDV, gr = 0, l = 0.5, p = "CO")
#' length(FE_LT_7_5_D_CO)
#' }
ef_hdv_scaled <- function(df, dfcol ,SDC  = 34.12, v, t, g, eu, gr = 0, l = 0.5 ,p) {
if(!missing(df)){
.Deprecated(msg = "df is not needed")
}
lapply(1:length(dfcol), function(i)  {
funIN <- ef_hdv_speed(v = v, t = t, g = g, eu = as.character(eu[i]),
gr = gr, l = l, p = p, k=1, show.equation = FALSE)
k <- dfcol[i]/ funIN(SDC)
funOUT <-  ef_hdv_speed(v = v, t = t, g = g,eu = as.character(eu[i]),
gr = gr, l = l, p = p, k = k, show.equation = FALSE)
return(funOUT)
})
}
data(fe2015)
co1 <- fe2015[fe2015$Pollutant=="CO",]
FE_LT_7_5_D_CO <- ef_hdv_scaled(co1, co1$LT, v = "Trucks", t = "RT",
g = "<=7.5", eu = co1$Euro_HDV, gr = 0, l = 0.5, p = "CO")
length(FE_LT_7_5_D_CO)
lef[[1]](40) # First element of the lit of speed functions at 40 km/h
lef[[36]](50) # 36th element of the lit of speed functions at 50 km/h
lef <- ef_ldv_scaled(co1, co1$PC_G, v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")
length(lef)
lef[[1]](40) # First element of the lit of speed functions at 40 km/h
lef[[36]](50) # 36th element of the lit of speed functions at 50 km/h
lef[[1]](40:50) # First element of the lit of speed functions at 40 km/h
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
plot(x = 0:150, y = lef[[36]](0:150), col = "red", type = "b")
plot(x = 0:150, y = lef[[1]](0:150), col = "blue", type = "b")
plot(x = 0:150, y = lef[[36]](0:150), col = "red", type = "b")
lines(x = 0:150, y = lef[[1]](0:150), col = "blue", type = "b")
plot(x = 0:150, y = lef[[1]](0:150), col = "blue", type = "b")
plot(x = 0:150, y = lef[[1]](0:150), col = "blue", type = "b",
pch = 16, main = "Variation of emissions with speed of newest vehicle")
plot(x = 0:150, y = lef[[36]](0:150), col = "red", type = "b", ylab = [g/km],
pch = 16, xlab = "[km/h]",
main = "Variation of emissions with speed of oldest vehicle")
plot(x = 0:150, y = lef[[36]](0:150), col = "red", type = "b", ylab = [g/km],
plot(x = 0:150, y = lef[[36]](0:150), col = "red", type = "b", ylab = "[g/km]",
pch = 16, xlab = "[km/h]",
main = "Variation of emissions with speed of oldest vehicle")
plot(x = 0:150, y = lef[[1]](0:150), col = "blue", type = "b", ylab = "[g/km]",
pch = 16, xlab = "[km/h]",
main = "Variation of emissions with speed of newest vehicle")
devtools::load_all(".")
lef <- ef_hdv_scaled(co1, co1$LT, v = "Trucks", t = "RT",
g = "<=7.5", eu = co1$Euro_HDV, gr = 0, l = 0.5, p = "CO")
length(lef)
plot(x = 0:150, y = lef[[36]](0:150), col = "red", type = "b", ylab = "[g/km]",
pch = 16, xlab = "[km/h]",
main = "Variation of emissions with speed of oldest vehicle")
plot(x = 0:150, y = lef[[1]](0:150), col = "blue", type = "b", ylab = "[g/km]",
pch = 16, xlab = "[km/h]",
main = "Variation of emissions with speed of newest vehicle")
devtools::load_all(".")
library(devtools)
use_testthat()
use_test("ef_ldv_speed")
ef1 <- ef_ldv_speed(v = "PC",t = "4S", cc = "<=1400", f = "G", eu = "PRE",
p = "CO")
ef_ldv_speed(v = "PC",t = "4S", cc = "<=1400", f = "G", eu = "PRE",
p = "CO")(10)
ef_ldv_speed(v = "PC",t = "4S", cc = "<=1400", f = "G", eu = "PRE",
p = "CO", show.equation = F)(10)
#
test_that("ef_ldv_speed works", {
expect_equal(ef_ldv_speed(v = "PC",t = "4S", cc = "<=1400", f = "G", eu = "PRE",
p = "CO", show.equation = F)(10), 65.87283)
})
library(devtools)
library(testthat)
#
test_that("ef_ldv_speed works", {
expect_equal(ef_ldv_speed(v = "PC",t = "4S", cc = "<=1400", f = "G", eu = "PRE",
p = "CO", show.equation = F)(10), 65.87283)
})
use_test("ef_hdv_speed")
?ef_hdv_speed
ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC")(10)
test_that("ef_hdv_speed works", {
expect_equal(ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(10), 0.4303939)
})
ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(10)
test_that("ef_hdv_speed works", {
expect_equal(ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(10), 0.4303939)
})
ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(30)
expect_equal(ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(30), 0.2073987)
print(ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(30), digits = 10)
test_that("ef_hdv_speed works", {
expect_equal(ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(30), 0.207398745)
})
test_that("ef_hdv_speed works", {
expect_equal(ef_hdv_speed(v = "Trucks",t = "RT", g = "<=7.5", e = "II", gr = 0,
l = 0.5, p = "HC", show.equation = FALSE)(30), 0.207398745)
})
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
library(vein)
inventory(name = file.path(tempdir(), "YourCity"), show.dir = TRUE,
show.scripts = TRUE)
pkgdown:::build_site_rstudio()
source(paste0(file.path(tempdir(), "YourCity"), "/main.R"))
source(paste0(file.path(tempdir(), "YourCity"), "/main.R"))
setwd('/tmp/Rtmpllu2Wk/YourCity')
library(vein)
sessionInfo()
# 1) Network ####
# Edit your net information and save net.rds it in network directory
# Your net must contain traffic per street at morning rush hour
# Below an example using the data in VEIN
data(net)
head(net)
# Are you going to need Speed?
# if yes, follow the example in netspeed
# ?netspeed
saveRDS(net, 'network/net.rds')
source('traffic.R') # Edit traffic.R
# 3) Estimation ####
# Edit each input.R
# You must have all the information required in each input.R
inputs <- list.files(path = 'est', pattern = 'input.R',
recursive = TRUE, full.names = TRUE)
inputs
name = file.path(tempdir(), "YourCity")
lista <- list.dirs(path = paste0(name,"/emi"))
lista
devtools::load_all("~/Documents/vein")
library(vein)
library(vein)
