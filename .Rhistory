lpc
E_COv2 <- emis(veh = lpc,lkm = net$lkm, ef = lef, speed = speed,
hour = 2, day = 1)
devtools::load_all(".")
library(vein)
library(vein)
PC_CO_COLDv2 <- emis_cold(veh = pc1, lkm = net$lkm, ef = lef, efcold = lefec,
beta = pcf, speed = speed, profile = pc_profile, hour = 2,
day = 1)
E_COv2 <- emis(veh = lpc,lkm = net$lkm, ef = lef, speed = speed,
hour = 2, day = 1)
vkms  <- vkm(veh = pc, lkm = lkm, profile = pro)
warnings()
pc <- lkm <- abs(rnorm(10,1,1))*100
pro <- matrix(abs(rnorm(24*7,0.5,1)), ncol=7, nrow=24)
vkms  <- vkm(veh = pc, lkm = lkm, profile = pro)
vkms
devtools::load_all(".")
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
ef_wear
speed <- df
if(is.data.frame(speed)){
speed <- speed
} else if(is.matrix(speed)){
speed <- speed
} else if(is.vector(speed)){
speed <- matrix(speed, ncol = 1)
}
for (i  in 1:ncol(speed) ) {
speed[, i] <- as.numeric(speed[, i])
}
wear = "tyre"
type = "PC"
ef <- ifelse(type=="2W", 0.0046, ifelse(type=="PC",0.0107,
ifelse(type=="LCV", 0.0109, ifelse(type=="HDV",
(axle/2)*(1.41 + 1.38*load)*0.0107))))
ef
f <- ifelse(pol=="TSP", 1, ifelse(pol=="PM10",0.6,ifelse(pol=="PM2.5",
0.42, ifelse(pol=="PM1",0.06, ifelse(pol=="PM0.1",0.048,"pol")))))
pol <- "PM10"
f <- ifelse(pol=="TSP", 1, ifelse(pol=="PM10",0.6,ifelse(pol=="PM2.5",
0.42, ifelse(pol=="PM1",0.06, ifelse(pol=="PM0.1",0.048,"pol")))))
f
sv <- ifelse(speed > 40,1.39,ifelse(speed >= 40 & speed <= 90,
-0.00974*speed + 1.78, 0.902))
sv
class(sv)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = net$ps)
is.vector(net$ps)
class(net$ps)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = as.nummeric(net$ps))
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = as.numeric(net$ps))
ef
class(ef)
dim(ef)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
ef
ef <- ifelse(type=="2W", 0.0046,
ifelse(type=="PC",0.0107,
ifelse(type=="LCV", 0.0109,
ifelse(type=="HDV",
(axle/2)*(1.41 + 1.38*load)*0.0107))))
f <- ifelse(pol=="TSP", 1,
ifelse(pol=="PM10", 0.6,
ifelse(pol=="PM2.5", 0.42,
ifelse(pol=="PM1",0.06,
ifelse(pol=="PM0.1",0.048,"pol")))))
sv <- ifelse(speed > 40, 1.39,
ifelse(speed >= 40 & speed <= 90,
-0.00974*speed + 1.78, 0.902))
dim(Ef)
dim(ef)
ef
f
sv
class(sv)
class(net$ps)
is.vector(net$ps)
is.numeric(net$ps)
devtools::load_all(".")
library(vein)
library(vein)
library(vein)
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
class(ef)
head(ef)
dim(ef)
plot(ef)
data(net)
data(pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10",
speed = df)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10",
speed = df)
head(ef)
data(profiles)
pro <- profiles$PC_JUNE_2012
pro <- profiles$PC_JUNE_2012[, 1]
pc_week <- temp_fact(net$ldv+net$hdv, pro)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
df
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10",
speed = df)
head(ef)
dim(ef)
lef <- EmissionFactorsList(ef)
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = lef, profile =  profiles$PC_JUNE_2012)
emis_wear
length(ef)
length(lef)
class(lef[[1]])
head(ef)
emis_wear
length(lef)
length(lef[[1]])
lef <- as.list(ef)
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = lef, profile =  profiles$PC_JUNE_2012)
class(emi)
emi
emis_wear
ef
identical(ef$V1, ef$V15)
plot(ef$V1)
plot(ef$V5)
(ef$V1/ef$V15)
dim(ef)
ncol(ef)
ncol(profile)
ncol(profiles$PC_JUNE_2012)
day <- 7
day
lef <-lapply(1:day, function(i){
as.list(ef[, (24*(i-1) + 1):(24*i)])
})
class(ef)
dim(Ef)
dim(ef)
day <- 1
lef <-lapply(1:day, function(i){
as.list(ef[, (24*(i-1) + 1):(24*i)])
})
length(lef)
length(lef[[1]])
length(lef[[1]][[1]])
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
data(pc_profile)
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = lef, profile =  pc_profile)
df
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = ef, profile =  pc_profile)
emi
system.time(
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = ef, profile =  pc_profile)
)
devtools::load_all(".")
library(vein)
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
library(vein)
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = ef, profile =  pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile[, 1])
pc_week
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = ef, profile =  pc_profile[, 1])
is.data.frame(pc_profile[, 1])
is.matrix(pc_profile[, 1])
is.vector(pc_profile[, 1])
devtools::load_all(".")
library(vein)
library(vein)
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile[, 1])
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = ef, profile =  pc_profile[, 1])
emi
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile[, 1])
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
emi <- emis_wear(veh = age_ldv(net$ldv, name = "VEH"),
lkm = net$lkm, ef = ef, profile =  pc_profile[, 1])
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
library(vein)
name = file.path(tempdir(), "YourCity")
inventory(name = name, show.dir = TRUE, show.scripts = TRUE)
source(paste0(name, "/main.R"))
devtools::load_all("~/Documentos/vein")
library(vein)
library(vein)
library(vein)
name = file.path(tempdir(), "YourCity")
inventory(name = name, show.dir = TRUE, show.scripts = TRUE)
source(paste0(name, "/main.R"))
name = file.path(tempdir(), "YourCity")
inventory(name = name, show.dir = TRUE, show.scripts = TRUE, rush.hour = T)
source(paste0(name, "/main.R"))
}
pkgdown:::build_site_rstudio()
getwd()
setwd("~/Documentos/vein/")
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
?sf::st_as_sf
?sf::st_sf
library(vein)
data(net)
netsf <- sf::st_as_sf(net)
netsf
st_Sfc(netsg)
st_sfc(netsg)
sf::st_sfc(netsg)
sf::st_sfc(netsf)
netsf$geometry
devtools::load_all(".")
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm)
class(df)
plot(df) #plot of the average speed at each hour, +- sd
df <- netspeed(ps = net$ps, ffs = net$ffs, scheme = TRUE)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
class(df)
plot(df) #plot of the average speed at each hour, +- sd
df <- netspeed(ps = net$ps, ffs = net$ffs, scheme = TRUE)
class(df)
plot(df) #plot of the average speed at each hour, +- sd
dfsf <- netspeed(ps = net$ps, ffs = net$ffs, scheme = TRUE, net = net)
class(dfsf)
plot(dfsf) #plot of the average speed at each hour, +- sd
head(dfsf)
rm(net)
rm(df)
ls()
rm(ls())
rm(ls()[1])
rm(dfsf)
rm(netsf)
rm(pc_profile)
rm(pc_week)
data(net)
data(pc_profile)
data(fe2015)
data(fkm)
PC_G <- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
133833,138441,142682,171029,151048,115228,98664,126444,101027,
84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
veh <- data.frame(PC_G = PC_G)
# Estimation for morning rush hour and local emission factors
speed <- data.frame(S8 = net$ps)
p1h <- matrix(1)
lef <- EmissionFactorsList(fe2015[fe2015$Pollutant=="CO", "PC_G"])
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed,
profile = p1h)
E_CO_STREETS <- emis_post(arra = E_CO, pollutant = "CO", by = "streets_wide")
summary(E_CO_STREETS)
E_CO_STREETSsf <- emis_post(arra = E_CO, pollutant = "CO",
by = "streets_wide", net = net)
data(net)
data(pc_profile)
data(fe2015)
data(fkm)
PC_G <- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
133833,138441,142682,171029,151048,115228,98664,126444,101027,
84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
veh <- data.frame(PC_G = PC_G)
# Estimation for morning rush hour and local emission factors
speed <- data.frame(S8 = net$ps)
p1h <- matrix(1)
lef <- EmissionFactorsList(fe2015[fe2015$Pollutant=="CO", "PC_G"])
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed,
profile = p1h)
E_CO <- emis(veh = 1h,lkm = net$lkm, ef = lef, speed = speed,
E_CO <- emis(veh = veh,lkm = net$lkm, ef = lef, speed = speed,
profile = p1h)
p1h
veh
args(my_age)
?my_age
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed,
profile = p1h)
E_CO_STREETS <- emis_post(arra = E_CO, pollutant = "CO", by = "streets_wide")
summary(E_CO_STREETS)
E_CO_STREETSsf <- emis_post(arra = E_CO, pollutant = "CO",
by = "streets_wide", net = net)
summary(E_CO_STREETSsf)
plot(E_CO_STREETS)
plot(E_CO_STREETSsf)
plot(E_CO_STREETSsf, main = "CO emissions (g/h)")
# arguments required: arra, veh, size, fuel, pollutant ad by
E_CO_DF <- emis_post(arra = E_CO,  veh = "PC", size = "<1400", fuel = "G",
pollutant = "CO", by = "veh")
# Estimation 168 hours
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
pcw <- temp_fact(net$ldv+net$hdv, pc_profile)
speed <- netspeed(pcw, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
pckm <- fkm[[1]](1:24); pckma <- cumsum(pckm)
cod1 <- emis_det(po = "CO", cc = 1000, eu = "III", km = pckma[1:11])
cod2 <- emis_det(po = "CO", cc = 1000, eu = "I", km = pckma[12:24])
#vehicles newer than pre-euro
co1 <- fe2015[fe2015$Pollutant=="CO", ] #24 obs!!!
cod <- c(co1$PC_G[1:24]*c(cod1,cod2),co1$PC_G[25:nrow(co1)])
lef <- ef_ldv_scaled(co1, cod, v = "PC",  cc = "<=1400",
f = "G",p = "CO", eu=co1$Euro_LDV)
args(ef_ldv_scaled)
lef <- ef_ldv_scaled(dfcol = cod, v = "PC",  cc = "<=1400",
f = "G",p = "CO", eu=co1$Euro_LDV)
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed, agemax = 41,
profile = pc_profile)
devtools::load_all(".")
library(vein)
library(vein)
list.files("tests/testthat/")
use_test("ef_hdv_scaled")
library(devtools)
library(testthat)
use_testthat()
use_test("ef_hdv_scaled")
list.files("tests/testthat/")
use_test("ef_ldv_cold")
list.files("tests/testthat/")
use_test("ef_ldv_scaled")
?ef_ldv_scaled
data(fe2015)
co1 <- fe2015[fe2015$Pollutant=="CO", ]
co1
co1 <- fe2015[fe2015$Pollutant=="CO", "PC_G"]
co1
co1 <- fe2015[fe2015$Pollutant=="CO", "PC_G"][1:2]
co1
lef <- ef_ldv_scaled(dfcold = co1, v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")
lef <- ef_ldv_scaled(dfcol = co1, v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")
co1 <- fe2015[fe2015$Pollutant=="CO", ]
lef <- ef_ldv_scaled(dfcol = co1$PC_G[1:2], v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")
lef
length(lef)
lef <- ef_ldv_scaled(dfcol = co1$PC_G[1:2], v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")(10)
class(lef)
class(lef[[1]])
lef[[1]]
lef <- ef_ldv_scaled(dfcol = co1$PC_G[1:2], v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")
lef <- ef_ldv_scaled(dfcol = co1$PC_G[1], v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")
lef <- ef_ldv_scaled(dfcol = co1$PC_G[1], v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")[[1]](10)
lef
expect_equal(ef_ldv_scaled(dfcol = co1$PC_G[1], v = "PC", t = "4S",
cc = "<=1400", f = "G",
eu = co1$Euro_LDV, p = "CO")[[1]](10),
0.1873607)
?ef_hdv_scaled
test_that("ef_hdv_scaled works", {
expect_equal(ef_hdv_scaled(dfcol = co1$LT, v = "Trucks", t = "RT",
g = "<=7.5", eu = co1$Euro_HDV, gr = 0,
l = 0.5, p = "CO")[[1]](10),
0.1873607)
})
ef_hdv_scaled(dfcol = co1$LT, v = "Trucks", t = "RT",
g = "<=7.5", eu = co1$Euro_HDV, gr = 0,
l = 0.5, p = "CO")[[1]](10)
test_that("ef_hdv_scaled works", {
expect_equal(ef_hdv_scaled(dfcol = co1$LT, v = "Trucks", t = "RT",
g = "<=7.5", eu = co1$Euro_HDV, gr = 0,
l = 0.5, p = "CO")[[1]](10),
0.06293748)
})
list.files("tests/testthat/")
?ef_nitro
efe10 <- ef_nitro(v = "PC", t = "Hot", cc = "Urban", f = "G",
eu = "III", p = "NH3", S = 10,
show.equation = FALSE)
efe10
efe10(!0)
efe10(10)
use_test("ef_nitro")
test_that("multiplication works", {
expect_equal( ef_nitro(v = "PC", t = "Hot", cc = "Urban", f = "G",
eu = "III", p = "NH3", S = 10,
show.equation = FALSE)(10),
0.001637825)
})
list.files("tests/testthat/")
use_test("ef_wear")
ef_wear
?ef_wear
ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
data(net)
data(pc_profile)
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
pc_week <- temp_fact(net$ldv, matrix(1))
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)[1]
dfw <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
class(dfw)
dim(dfw)
pc_week <- temp_fact(net$ldv[1], matrix(1))
df <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
dfw <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
dim(dfw)
net$ldv[1]
pc_week <- temp_fact(net$ldv[1], matrix(1))
df <- netspeed(pc_week, net$ps[1], net$ffs[1], net$capacity[1], net$lkm[1], alpha = 1)
dfw <- ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
dim(dfw)
dfw
ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df)
as.numeric(ef_wear(wear = "tyre", type = "PC", pol = "PM10", speed = df))
test_that("ef_Wear works", {
expect_equal(as.numeric(ef_wear(wear = "tyre", type = "PC", pol = "PM10",
speed = df)),
0.00579084)
})
pkgdown:::build_site_rstudio()
pc <- rnorm(100, 300, 10)
dpc <- c(rnorm(10, 99, 1), NA, NA, NA)
PC_E25_1400 <- my_age(x = pc, y = dpc, name = "PC_E25_1400")
PC_E25_1400 <- vein::my_age(x = pc, y = dpc, name = "PC_E25_1400")
plot(PC_E25_1400)
pc
pc
dpc <- c(seq(1,20,3), 20:10)
plot(dpc)
devtools::load_all(".")
library(vein)
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
knitr::opts_chunk$set(echo = TRUE)
names(dfspeednet)
library(rmarkdown)
?render
installed.packages("prettydoc")
install.packages("prettydoc")
pkgdown:::build_site_rstudio()
pkgdown:::build_site_rstudio()
