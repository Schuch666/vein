cn = d[["cn"]],
t95 = d[["t95"]])/
f_cov_ldv_d(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 = bd1996[["t95"]])
fnox_ldv_d <- f_nox_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_nox_ldv_d(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 =bd1996[["t95"]])
fpm_ldv_d <- f_pm_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]],
s = d[["s"]])/
f_pm_ldv_d(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 = bd1996[["t95"]],
s = bd1996[["s"]])
} else if(euro == "III"){
fco_ldv_d <- f_co_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_co_ldv_d(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 = bd2000[["t95"]])
fcov_ldv_d <- f_cov_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_cov_ldv_d(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 = bd2000[["t95"]])
fnox_ldv_d <- f_nox_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_nox_ldv_d(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 =bd2000[["t95"]])
fpm_ldv_d <- f_pm_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]],
s = d[["s"]])/
f_pm_ldv_d(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 = bd2000[["t95"]],
s = bd2000[["s"]])
} else if(euro == "IV"){
fco_ldv_d <- f_co_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_co_ldv_d(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 = bd2005[["t95"]])
fcov_ldv_d <- f_cov_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_cov_ldv_d(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 = bd2005[["t95"]])
fnox_ldv_d <- f_nox_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_nox_ldv_d(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 =bd2005[["t95"]])
fpm_ldv_d <- f_pm_ldv_d(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]],
s = d[["s"]])/
f_pm_ldv_d(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 = bd2005[["t95"]],
s = bd2005[["s"]])
} else {
fco_ldv_d <- fco_ldv_d <- fco_ldv_d <- fpm_ldv_d <- 1
}
# } else if(tveh == "HDV"){
if(euro %in% c("PRE", "I", "II")){
fco_hdv <- f_co_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_co_hdv(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 = bd1996[["t95"]])
fcov_hdv <- f_cov_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_cov_hdv(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 = bd1996[["t95"]])
fnox_hdv <- f_nox_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_nox_hdv(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 =bd1996[["t95"]])
fpm_hdv <- f_pm_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]],
s = d[["s"]])/
f_pm_hdv(den = bd1996[["den"]],
pah = bd1996[["pah"]],
cn = bd1996[["cn"]],
t95 = bd1996[["t95"]],
s = bd1996[["s"]])
} else if(euro == "III"){
fco_hdv <- f_co_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_co_hdv(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 = bd2000[["t95"]])
fcov_hdv <- f_cov_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_cov_hdv(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 = bd2000[["t95"]])
fnox_hdv <- f_nox_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_nox_hdv(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 =bd2000[["t95"]])
fpm_hdv <- f_pm_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]],
s = d[["s"]])/
f_pm_hdv(den = bd2000[["den"]],
pah = bd2000[["pah"]],
cn = bd2000[["cn"]],
t95 = bd2000[["t95"]],
s = bd2000[["s"]])
} else if(euro == "IV"){
fco_hdv <- f_co_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_co_hdv(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 = bd2005[["t95"]])
fcov_hdv <- f_cov_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_cov_hdv(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 = bd2005[["t95"]])
fnox_hdv <- f_nox_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]])/
f_nox_hdv(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 =bd2005[["t95"]])
fpm_hdv <- f_pm_hdv(den = d[["den"]],
pah = d[["pah"]],
cn = d[["cn"]],
t95 = d[["t95"]],
s = d[["s"]])/
f_pm_hdv(den = bd2005[["den"]],
pah = bd2005[["pah"]],
cn = bd2005[["cn"]],
t95 = bd2005[["t95"]],
s = bd2005[["s"]])
} else {
fco_hdv_d <- fcov_hdv_d <- fnox_hdv_d <- fpm_hdv_d <- 1
}
# }
fif <- function(x) ifelse(x < 0, 1, x)
dfl <- list(
LDVG = list(CO = list(fif(fco_ldv_g)),
COV = list(fif(fcov_ldv_g)),
NOx = list(fif(fnox_ldv_g))),
LDVD = list(CO = list(fif(fco_ldv_d)),
COV = list(fif(fcov_ldv_d)),
NOx = list(fif(fnox_ldv_d)),
PM = list(fif(fnox_ldv_d))),
HDV = list(CO = list(fif(fco_hdv)),
COV = list(fif(fcov_hdv)),
NOx = list(fif(fnox_hdv)),
PM = list(fif(fpm_hdv))))
return(dfl)
}
f <- fuel_corr(euro = "I")
names(f)
f$LDVG
f$LDVG$CO
devtools::load_all(".")
devtools::load_all(".")
library(vein)
rm(fuel_corr)
devtools::load_all(".")
library(vein)
library(vein)
knitr::opts_chunk$set(echo = TRUE)
library(vein)
data("net")
PC_E25_1400net <- age_ldv(x = net$ldv, name = "PC_E25_1400", net = net)
spplot(as(PC_E25_1400net, "Spatial"),
c("PC_E25_1400_1", "PC_E25_1400_9"),
main = "PC by age of use", axes = TRUE)
PC_E25_1400net <- age_ldv(x = net$ldv, name = "PC_E25_1400", net = net)
sp::spplot(as(PC_E25_1400net, "Spatial"),
c("PC_E25_1400_1", "PC_E25_1400_9"),
main = "PC by age of use", scales = list(draw = T))
sp::spplot(as(PC_E25_1400net, "Spatial"),
c("PC_E25_1400_1", "PC_E25_1400_9"),
main = "PC by age of use", scales = list(draw = T))
sp::spplot(as(PC_E25_1400net, "Spatial"),
c("PC_E25_1400_1", "PC_E25_1400_9"),
main = "PC by age of use", scales = list(draw = T),
col.regions = rev(cptcity::cpt()))
sp::spplot(as(PC_E25_1400net, "Spatial"),
c("PC_E25_1400_1", "PC_E25_1400_9"),
main = "PC by age of use", scales = list(draw = T),
col.regions = rev(cptcity::cpt()))
dfspeednet <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm,
alpha = 1.5, net = net)
data("net")
data("pc_profile")
pc_week <- temp_fact(net$ldv+net$hdv, pc_profile)
dfspeed <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1.5)
dfspeednet <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm,
alpha = 1.5, net = net)
plot(dfspeednet[c("S1", "S9")], axes = TRUE)
sp::spplot(as(dfspeednet, "Spatial"),
c("S1", "S9"), scales = list(draw = T),
col.regions = rev(cptcity::cpt()))
dfspeednet <- netspeed(pc_week, net$ps, net$ffs, net$capacity, net$lkm,
alpha = 1.5, net = net)
sp::spplot(as(dfspeednet, "Spatial"),
c("S1", "S9"), scales = list(draw = T),
col.regions = rev(cptcity::cpt()))
sp::spplot(as(dfspeednet, "Spatial"),
c("S1", "S9"), scales = list(draw = T),
col.regions = rev(cptcity::cpt()))
euro <- c(rep("V", 5), rep("IV", 5), rep("III", 5), rep("II", 5),
rep("I", 5), rep("PRE", 15))
lef <- lapply(1:40, function(i) {
ef_ldv_speed(v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = euro[i], p = "CO", show.equation = FALSE) })
E_CO <- emis(veh = PC_E25_1400, lkm = net$lkm, ef = lef, speed = dfspeed,
profile = pc_profile)
data("net")
PC_E25_1400 <- age_ldv(x = net$ldv, name = "PC_E25_1400")
plot(PC_E25_1400, xlab = "age of use")
plot(PC_E25_1400, xlab = "age of use")
euro <- c(rep("V", 5), rep("IV", 5), rep("III", 5), rep("II", 5),
rep("I", 5), rep("PRE", 15))
lef <- lapply(1:40, function(i) {
ef_ldv_speed(v = "PC", t = "4S", cc = "<=1400", f = "G",
eu = euro[i], p = "CO", show.equation = FALSE) })
E_CO <- emis(veh = PC_E25_1400, lkm = net$lkm, ef = lef, speed = dfspeed,
profile = pc_profile)
plot(E_CO, xlab = "Hours", ylab = "[g/h]")
pkgdown:::build_site_rstudio()
devtools::load_all(".")
library(vein)
devtools::load_all(".")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
library(vein)
ef_ldv_cold()
ef_ldv_cold
args(ef_ldv_cold)
?ef_ldv_cold
(0.15 - 0.1)/0.1
(0.15 - 0.1)/0.1*100
(0.15 - 0.1)
(0.15 - 0.1)/0.1
0.15/0.1
0.1*1.5
3.83/0.26
2.23/0.26
53/..1
53/1.13
88/12
878/40
236/17
4662/141
install.packages("pkgdown")
knitr::opts_chunk$set(echo = TRUE)
knitr::include_graphics("https://i.imgur.com/b2lQZzi.jpg")
knitr::include_graphics("https://i.imgur.com/b2lQZzi.jpg")
knitr::include_graphics("https://i.imgur.com/wp3fi1i.png")
devtools::load_all(".")
knitr::include_graphics("https://i.imgur.com/wp3fi1i.png")
library(vein)
library(vein)
pkgdown:::build_site_rstudio()
devtools::load_all(".")
pkgdown:::build_site_rstudio()
data(net)
data(pc_profile)
data(fe2015)
data(fkm)
PC_G <- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
133833,138441,142682,171029,151048,115228,98664,126444,101027,
84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
# Estimation for morning rush hour and local emission factors
speed <- data.frame(S8 = net$ps)
p1h <- matrix(1)
lef <- EmissionFactorsList(fe2015[fe2015$Pollutant=="CO", "PC_G"])
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed,
profile = p1h)
E_CO_STREETS <- emis_post(arra = E_CO, pollutant = "CO", by = "streets_wide")
summary(E_CO_STREETS)
E_CO_STREETSsf <- emis_post(arra = E_CO, pollutant = "CO",
by = "streets_wide", net = net)
summary(E_CO_STREETSsf)
plot(E_CO_STREETSsf, main = "CO emissions (g/h)")
# arguments required: arra, veh, size, fuel, pollutant ad by
E_CO_DF <- emis_post(arra = E_CO,  veh = "PC", size = "<1400", fuel = "G",
pollutant = "CO", by = "veh")
# Estimation 168 hours
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
pcw <- temp_fact(net$ldv+net$hdv, pc_profile)
speed <- netspeed(pcw, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
pckm <- fkm[[1]](1:24); pckma <- cumsum(pckm)
cod1 <- emis_det(po = "CO", cc = 1000, eu = "III", km = pckma[1:11])
cod2 <- emis_det(po = "CO", cc = 1000, eu = "I", km = pckma[12:24])
#vehicles newer than pre-euro
co1 <- fe2015[fe2015$Pollutant=="CO", ] #24 obs!!!
cod <- c(co1$PC_G[1:24]*c(cod1,cod2),co1$PC_G[25:nrow(co1)])
lef <- ef_ldv_scaled(dfcol = cod, v = "PC",  cc = "<=1400",
f = "G",p = "CO", eu=co1$Euro_LDV)
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed, agemax = 41,
profile = pc_profile)
library(vein)
data(net)
data(pc_profile)
data(fe2015)
data(fkm)
PC_G <- c(33491,22340,24818,31808,46458,28574,24856,28972,37818,49050,87923,
133833,138441,142682,171029,151048,115228,98664,126444,101027,
84771,55864,36306,21079,20138,17439, 7854,2215,656,1262,476,512,
1181, 4991, 3711, 5653, 7039, 5839, 4257,3824, 3068)
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
# Estimation for morning rush hour and local emission factors
speed <- data.frame(S8 = net$ps)
p1h <- matrix(1)
lef <- EmissionFactorsList(fe2015[fe2015$Pollutant=="CO", "PC_G"])
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed,
profile = p1h)
E_CO_STREETS <- emis_post(arra = E_CO, pollutant = "CO", by = "streets_wide")
summary(E_CO_STREETS)
E_CO_STREETSsf <- emis_post(arra = E_CO, pollutant = "CO",
by = "streets_wide", net = net)
summary(E_CO_STREETSsf)
plot(E_CO_STREETSsf, main = "CO emissions (g/h)")
# arguments required: arra, veh, size, fuel, pollutant ad by
E_CO_DF <- emis_post(arra = E_CO,  veh = "PC", size = "<1400", fuel = "G",
pollutant = "CO", by = "veh")
# Estimation 168 hours
pc1 <- my_age(x = net$ldv, y = PC_G, name = "PC")
pcw <- temp_fact(net$ldv+net$hdv, pc_profile)
speed <- netspeed(pcw, net$ps, net$ffs, net$capacity, net$lkm, alpha = 1)
pckm <- fkm[[1]](1:24); pckma <- cumsum(pckm)
cod1 <- emis_det(po = "CO", cc = 1000, eu = "III", km = pckma[1:11])
cod2 <- emis_det(po = "CO", cc = 1000, eu = "I", km = pckma[12:24])
#vehicles newer than pre-euro
co1 <- fe2015[fe2015$Pollutant=="CO", ] #24 obs!!!
cod <- c(co1$PC_G[1:24]*c(cod1,cod2),co1$PC_G[25:nrow(co1)])
lef <- ef_ldv_scaled(dfcol = cod, v = "PC",  cc = "<=1400",
f = "G",p = "CO", eu=co1$Euro_LDV)
E_CO <- emis(veh = pc1,lkm = net$lkm, ef = lef, speed = speed, agemax = 41,
profile = pc_profile)
dim(E_CO)
x <- unlist(lapply(1:dim(arra)[4], function(j) {# dia
unlist(lapply (1:dim(arra)[3],function(i) { # hora
rowSums(arra[,,i,j], na.rm = T)
}))
}))
x <- lapply(1:dim(arra)[4], function(j) {# dia
lapply (1:dim(arra)[3],function(i) { # hora
arra[,,i,j]
})
})
x <- unlist(lapply(1:dim(arra)[4], function(j) {# dia7
arra <- E_CO
x <- lapply(1:dim(arra)[4], function(j) {# dia
lapply (1:dim(arra)[3],function(i) { # hora
arra[,,i,j]
})
})
x
length(x)
length(x[[1]])
length(x[[1]][[1]])
1505*41
x <- lapply(1:dim(arra)[4], function(j) {# dia
lapply (1:dim(arra)[3],function(i) { # hora
lapply(1:dim(arra)[2], function(k){
arra[,,i,j]
})
})
})
arra[,k,i,j]
x <- lapply(1:dim(arra)[4], function(j) {# dia
lapply (1:dim(arra)[3],function(i) { # hora
lapply(1:dim(arra)[2], function(k){
arra[,k,i,j]
})
})
})
length(x)
length(x[[1]])
length(x[[1]][[1]])
EmissionsList(x)
EmissionsList
EmissionsList(x)
x <- unlist(lapply(1:dim(arra)[4], function(j) {# dia
unlist(lapply (1:dim(arra)[3],function(i) { # hora
rowSums(arra[,,i,j], na.rm = T)
}))
}))
dim(x)
class(x)
length(x)
m <- matrix(x, nrow=dim(arra)[1], ncol=dim(arra)[3]*dim(arra)[4])
df <- as.data.frame(m)
dim(df)
x <- unlist(lapply(1:dim(arra)[4], function(j) {# dia
unlist(lapply (1:dim(arra)[3],function(i) { # hora
lapply(1:dim(arra)[2], function(k){
arra[,k,i,j]
})
}))
}))
length(x)
class(x)
41*7*24
41*7*24*1505
x <- lapply(1:dim(arra)[4], function(j) {# dia
lapply (1:dim(arra)[3],function(i) { # hora
lapply(1:dim(arra)[2], function(k){
arra[,k,i,j]
})
})
})
length(x)
length(x)
length(x[[1]])
length(x[[1]][[1]])
dim(arra[, 1,,])
dim(arra[, 2,,])
dim(arra[, 1:,,])
dim(arra[, 1:3,,])
df <- Emissions(apply(X = arra, MARGIN = c(1,3), FUN = sum, na.rm = TRUE))
head(df)
arra <- E_CO
df <- lapply(1:dim(arra)[2], function(i){
apply(X = arra, MARGIN = c(1,3), FUN = sum, na.rm = TRUE)
})
head(apply(X = arra[, 2,,], MARGIN = c(1,3), FUN = sum, na.rm = TRUE))
head(apply(X = arra[, 1,,], MARGIN = c(1,3), FUN = sum, na.rm = TRUE))
dim(apply(X = arra[, 1,,], MARGIN = c(1,3), FUN = sum, na.rm = TRUE))
dim(apply(X = arra[, 1,,], MARGIN = c(1,2), FUN = sum, na.rm = TRUE))
dim(apply(X = arra[, 1,,], MARGIN = c(1,4), FUN = sum, na.rm = TRUE))
class(arra[, 1, , ])
dim(arra[, 1, , ])
dim(apply(X = arra[, 1,,], MARGIN = c(2,3), FUN = sum, na.rm = TRUE))
dim(apply(X = arra[, 1,,], MARGIN = c(1,3), FUN = sum, na.rm = TRUE))
dim(apply(X = arra[, 1,,], MARGIN = c(1,2), FUN = sum, na.rm = TRUE))
dim(apply(X = arra[, ,,], MARGIN = c(1,2), FUN = sum, na.rm = TRUE))
dim(arra)
rowSums(arra[ , 2:5, , ])
dim(rowSums(arra[ , 2:5, , ]))
rowSums(arra[ , 2:5, , ])
length(arra[ , 2:5, , ])
